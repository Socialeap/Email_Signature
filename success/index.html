<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Your Signature Is Ready!</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <style> body { font-family: 'Inter', sans-serif; } </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

  <div class="w-full max-w-3xl bg-white p-8 rounded-xl shadow-lg text-center">

    <!-- Loading -->
    <div id="loading">
      <h1 class="text-2xl font-bold text-gray-800">Finalizing Your Signatureâ€¦</h1>
      <div class="spinner mt-6 border-4 border-gray-300 border-t-4 border-t-indigo-600 rounded-full w-12 h-12 animate-spin mx-auto"></div>
    </div>

    <!-- Success Preview + Send Button -->
    <div id="ready" class="hidden">
      <h1 class="text-3xl font-bold text-green-600">Thank You!</h1>
      <p class="text-gray-700 mt-2">Weâ€™ll email your signature right away.</p>

      <!-- Live Preview -->
      <div class="my-6">
        <h2 class="text-xl font-semibold text-gray-800">Live Preview</h2>
        <div class="bg-gray-50 p-6 rounded-lg shadow-inner mt-2 inline-block text-left">
          <div id="preview-pane"></div>
        </div>
      </div>

      <!-- Send Button -->
      <div class="mt-4">
        <button id="send-btn"
                class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg transition-all">
          Send My Signature
        </button>
        <p id="send-msg" class="text-green-600 font-semibold mt-2 opacity-0 transition-opacity">Sent! Check your inbox.</p>
      </div>
    </div>

    <!-- Error -->
    <div id="error" class="hidden">
      <h1 class="text-2xl font-bold text-red-600">Oops!</h1>
      <p class="text-gray-600 mt-2">Something went wrong. Please try again or contact support.</p>
    </div>

  </div>

<!-- Replace the previous <script> block with this one -->

<script>
document.addEventListener('DOMContentLoaded', () => {
  const loading = document.getElementById('loading');
  const ready   = document.getElementById('ready');
  const error   = document.getElementById('error');
  const preview = document.getElementById('preview-pane');
  const sendBtn = document.getElementById('send-btn');
  const sendMsg = document.getElementById('send-msg');

  const params      = new URLSearchParams(window.location.search);
  const encodedData = params.get('data');
  const userEmail   = params.get('email');
  if (!encodedData || !userEmail) {
    loading.style.display = 'none';
    error.style.display   = 'block';
    return;
  }

  let signatureHtml = '';
  try {
    const { info={}, buttons=[], socials=[] } = JSON.parse(atob(encodedData));
    const phoneLink   = (info.phone||'').replace(/[^\d]/g,'');
    const websiteLink = info.website && info.website.startsWith('http')
                      ? info.website
                      : `https://${info.website||''}`;

    let btns = '';
    if (buttons.length) {
      btns = '<tr><td colspan="2" style="padding-top:12px;"><table><tr>';
      buttons.forEach(b => {
        btns += `<td style="padding-right:8px;">
          <a href="${b.url}" target="_blank" style="padding:6px 12px;background-color:${b.color};color:#fff;text-decoration:none;border-radius:18px;font-weight:bold;font-size:12px;">
            ${b.label}
          </a>
        </td>`;
      });
      btns += '</tr></table></td></tr>';
    }

    const icons = {
      Facebook:    'https://img.icons8.com/fluency/48/000000/facebook-new.png',
      LinkedIn:    'https://img.icons8.com/fluency/48/000000/linkedin.png',
      Instagram:   'https://img.icons8.com/fluency/48/000000/instagram-new.png',
      'X/Twitter': 'https://img.icons8.com/ios-filled/50/000000/twitterx.png'
    };
    let socs = '';
    if (socials.length) {
      socs = '<tr><td colspan="2" style="padding-top:10px;"><table><tr>';
      socials.forEach(s => {
        const icon = icons[s.network];
        if (s.url && icon) {
          socs += `<td style="padding-right:8px;">
            <a href="${s.url}" target="_blank">
              <img src="${icon}" width="24" height="24" style="border-radius:6px;" />
            </a>
          </td>`;
        }
      });
      socs += '</tr></table></td></tr>';
    }

    signatureHtml = `
      <table style="font-family:Arial,sans-serif;width:100%;">
        <tr>
          <td style="padding-right:16px;vertical-align:top;width:90px;">
            <img src="${info.image_url}" width="90" height="90" style="border-radius:50%;" />
          </td>
          <td style="vertical-align:top;padding-top:5px;">
            <div style="font-size:18px;font-weight:bold;color:#195070;">${info.name||''}</div>
            <div style="font-size:14px;color:#555;margin-top:2px;">
              ${info.title||''}${info.company? ' | '+info.company: ''}
            </div>
            <div style="margin-top:8px;">
              ${info.phone ? `<div><a href="tel:${phoneLink}" style="color:#195070;">${info.phone}</a></div>` : ''}
              ${info.website ? `<div><a href="${websiteLink}" target="_blank" style="color:#195070;">${info.website}</a></div>` : ''}
            </div>
          </td>
        </tr>
        ${btns}
        ${socs}
      </table>
    `.trim();

    preview.innerHTML      = signatureHtml;
    loading.style.display  = 'none';
    ready.style.display    = 'block';
  }
  catch (err) {
    console.error(err);
    loading.style.display = 'none';
    error.style.display   = 'block';
    return;
  }

  // ðŸ“© Send data to Jotform Webhook
  sendBtn.addEventListener('click', () => {
    sendBtn.disabled = true;

    fetch("https://hooks.jotform.com/webhook/251816819332056", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        email: userEmail,
        signature_html: signatureHtml
      })
    })
    .then(res => {
      if (!res.ok) throw new Error("Failed to send");
      sendMsg.classList.remove('opacity-0');
    })
    .catch(err => {
      console.error('Webhook error:', err);
      alert('Failed to send signature. Please try again.');
      sendBtn.disabled = false;
    });
  });
});
</script>

</body>
</html>
